import{d as $,r as S,w as D,c,a as e,e as p,o,b as f,t as g,l as k,x as y,p as n,R as T,n as w,y as V,q as j,f as B,m as I,F as P,z as C}from"./index-CV51tAj_.js";import{u as z,_ as L,a as M,b as R}from"./ErrorMessage.vue_vue_type_script_setup_true_lang-B_bs0a_A.js";import{u as N}from"./pinned-BV4Sx0qP.js";const A={class:"relative"},E=["value","placeholder"],F=$({__name:"SearchBar",props:{modelValue:{},placeholder:{},debounceMs:{}},emits:["update:modelValue","search"],setup(a,{emit:m}){const t=a,i=m,l=S(t.modelValue);let s=null;D(()=>t.modelValue,h=>{l.value=h});function d(h){const u=h.target.value;l.value=u,i("update:modelValue",u),s&&clearTimeout(s),s=setTimeout(()=>{i("search",u)},t.debounceMs??300)}function b(){l.value="",i("update:modelValue",""),i("search","")}return(h,u)=>(o(),c("div",A,[e("input",{type:"text",value:l.value,placeholder:a.placeholder||"搜尋...",class:"w-full rounded-xl border border-slate-200 bg-white py-3 pl-11 pr-11 text-slate-800 placeholder-slate-400 shadow-sm transition-colors focus:border-violet-500 focus:outline-none focus:ring-1 focus:ring-violet-500 dark:border-slate-700 dark:bg-slate-800 dark:text-white dark:placeholder-slate-500",onInput:d},null,40,E),u[1]||(u[1]=e("i",{class:"bi bi-search absolute left-4 top-1/2 -translate-y-1/2 text-slate-400"},null,-1)),l.value?(o(),c("button",{key:0,class:"absolute right-4 top-1/2 -translate-y-1/2 text-slate-400 transition-colors hover:text-slate-700 dark:hover:text-white",onClick:b},[...u[0]||(u[0]=[e("i",{class:"bi bi-x-lg"},null,-1)])])):p("",!0)]))}}),q={class:"flex items-center justify-between"},Q={class:"text-sm text-slate-500 dark:text-slate-400"},X={class:"font-medium text-slate-800 dark:text-white"},G={class:"font-medium text-slate-800 dark:text-white"},H={class:"font-medium text-slate-800 dark:text-white"},J={class:"flex gap-2"},K=["disabled"],O=["disabled"],W=$({__name:"PaginationNav",props:{pagination:{}},emits:["page-change"],setup(a,{emit:m}){const t=m;function i(l){t("page-change",l)}return(l,s)=>(o(),c("div",q,[e("p",Q,[s[2]||(s[2]=f(" 共 ",-1)),e("span",X,g(a.pagination.totalCount),1),s[3]||(s[3]=f(" 人，第 ",-1)),e("span",G,g(a.pagination.currentPage),1),s[4]||(s[4]=f(" / ",-1)),e("span",H,g(a.pagination.totalPages),1),s[5]||(s[5]=f(" 頁 ",-1))]),e("div",J,[e("button",{disabled:!a.pagination.hasPrevPage,class:"flex items-center gap-1 rounded-lg border border-slate-200 bg-white px-4 py-2 text-sm text-slate-700 shadow-sm transition-colors hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-50 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-300 dark:hover:bg-slate-700",onClick:s[0]||(s[0]=d=>i(a.pagination.currentPage-1))},[...s[6]||(s[6]=[e("i",{class:"bi bi-chevron-left"},null,-1),f(" 上一頁 ",-1)])],8,K),e("button",{disabled:!a.pagination.hasNextPage,class:"flex items-center gap-1 rounded-lg border border-slate-200 bg-white px-4 py-2 text-sm text-slate-700 shadow-sm transition-colors hover:bg-slate-50 disabled:cursor-not-allowed disabled:opacity-50 dark:border-slate-700 dark:bg-slate-800 dark:text-slate-300 dark:hover:bg-slate-700",onClick:s[1]||(s[1]=d=>i(a.pagination.currentPage+1))},[...s[7]||(s[7]=[f(" 下一頁 ",-1),e("i",{class:"bi bi-chevron-right"},null,-1)])],8,O)])]))}}),Y=["title","disabled"],Z=["src","alt"],ee={class:"min-w-0 flex-1"},te={class:"truncate font-medium text-slate-800 dark:text-white"},se={class:"truncate text-sm text-slate-500 dark:text-slate-400"},ae={class:"text-right"},le={class:"text-lg font-bold text-violet-600 dark:text-violet-400"},oe={class:"text-xs text-slate-500 dark:text-slate-400"},U=$({__name:"UserCard",props:{user:{},scheduleId:{},totalDays:{}},emits:["pinChanged"],setup(a,{emit:m}){const t=a,i=m,l=N(),s=k(()=>`https://cdn.discordapp.com/embed/avatars/${parseInt(t.user.discordUserId)%5}.png`),d=k(()=>l.isPinned(t.scheduleId,t.user.discordUserId)),b=k(()=>l.canPin(t.scheduleId));function h(u){u.preventDefault(),u.stopPropagation();const _=l.togglePin(t.scheduleId,t.user.discordUserId);i("pinChanged",t.user.discordUserId,!d.value&&_)}return(u,_)=>(o(),y(n(T),{to:{name:"user-detail",params:{scheduleId:a.scheduleId,discordUserId:a.user.discordUserId}},class:w(["group flex items-center gap-4 rounded-2xl border bg-white p-4 shadow-sm transition-all hover:shadow-md dark:bg-slate-800",d.value?"border-violet-200 dark:border-violet-700":"border-slate-200 hover:border-violet-200 dark:border-slate-700 dark:hover:border-violet-600"])},{default:V(()=>[e("button",{class:w(["flex-shrink-0 rounded-lg p-1.5 transition-colors",d.value?"text-violet-500 hover:bg-violet-100 dark:hover:bg-violet-900/50":b.value?"text-slate-400 hover:bg-slate-100 hover:text-violet-500 dark:hover:bg-slate-700":"cursor-not-allowed text-slate-300 dark:text-slate-600"]),title:d.value?"取消釘選":b.value?"釘選用戶":"已達釘選上限",disabled:!d.value&&!b.value,onClick:h},[e("i",{class:w(["bi text-base",d.value?"bi-pin-fill":"bi-pin"])},null,2)],10,Y),e("img",{src:a.user.avatarUrl||s.value,alt:a.user.displayName,class:w(["h-12 w-12 rounded-full object-cover ring-2 transition-all",d.value?"ring-violet-200 dark:ring-violet-700":"ring-slate-100 group-hover:ring-violet-200 dark:ring-slate-700 dark:group-hover:ring-violet-500"]),loading:"lazy"},null,10,Z),e("div",ee,[e("p",te,g(a.user.displayName),1),e("p",se,"@"+g(a.user.username),1)]),e("div",ae,[e("p",le,g(a.user.totalCheckinDays),1),e("p",oe,g(a.totalDays?`/ ${a.totalDays} 天`:"天"),1)])]),_:1},8,["to","class"]))}}),ne={class:"p-8"},re={class:"mb-8"},de={key:0,class:"mt-1 text-slate-500 dark:text-slate-400"},ie={class:"mb-6"},ue={key:0,class:"flex h-96 items-center justify-center"},ce={key:0,class:"mb-8"},he={class:"mb-3 flex items-center gap-2"},ge={class:"text-sm font-semibold text-slate-700 dark:text-slate-300"},ve={class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3"},me={key:1},be={key:0,class:"mb-3 flex items-center gap-2"},xe={class:"grid gap-4 sm:grid-cols-2 lg:grid-cols-3"},pe={key:2,class:"rounded-2xl border border-slate-200 bg-white py-16 text-center shadow-sm dark:border-slate-700 dark:bg-slate-800"},fe={class:"text-slate-500 dark:text-slate-400"},ke={key:3,class:"mt-8"},$e=$({__name:"UserList",setup(a){const m=j(),t=z(),i=N(),l=k(()=>m.params.scheduleId),s=S(""),d=k(()=>{const v=i.getPinnedIds(l.value);return t.users.filter(r=>v.includes(r.discordUserId))}),b=k(()=>{const v=i.getPinnedIds(l.value);return t.users.filter(r=>!v.includes(r.discordUserId))});async function h(v=1){await t.fetchUsers(l.value,{page:v,limit:20,search:s.value||void 0})}async function u(v){s.value=v,await h(1)}async function _(v){await h(v),window.scrollTo({top:0,behavior:"smooth"})}return B(()=>{h(),t.scheduleStats||t.fetchScheduleStats(l.value)}),(v,r)=>(o(),y(L,null,{default:V(()=>[e("div",ne,[e("div",re,[r[2]||(r[2]=e("h1",{class:"text-2xl font-bold text-slate-800 dark:text-white"},"參與者列表",-1)),n(t).scheduleStats?(o(),c("p",de,g(n(t).scheduleStats.scheduleName),1)):p("",!0)]),e("div",ie,[I(F,{modelValue:s.value,"onUpdate:modelValue":r[0]||(r[0]=x=>s.value=x),placeholder:"搜尋暱稱或 Discord ID...",onSearch:u},null,8,["modelValue"])]),n(t).isLoading&&n(t).users.length===0?(o(),c("div",ue,[I(M,{size:"lg"})])):n(t).error?(o(),y(R,{key:1,message:n(t).error,onRetry:r[1]||(r[1]=()=>h())},null,8,["message"])):(o(),c(P,{key:2},[d.value.length>0&&!s.value?(o(),c("div",ce,[e("div",he,[r[3]||(r[3]=e("i",{class:"bi bi-pin-fill text-violet-500"},null,-1)),e("h2",ge," 釘選用戶 ("+g(n(i).getPinnedCount(l.value))+"/"+g(n(i).MAX_PINNED)+") ",1)]),e("div",ve,[(o(!0),c(P,null,C(d.value,x=>(o(),y(U,{key:x.discordUserId,user:x,"schedule-id":l.value,"total-days":n(t).scheduleStats?.dailyTasks},null,8,["user","schedule-id","total-days"]))),128))])])):p("",!0),n(t).users.length>0?(o(),c("div",me,[d.value.length>0&&!s.value?(o(),c("div",be,[...r[4]||(r[4]=[e("i",{class:"bi bi-list-ul text-slate-500"},null,-1),e("h2",{class:"text-sm font-semibold text-slate-700 dark:text-slate-300"},"所有參與者",-1)])])):p("",!0),e("div",xe,[(o(!0),c(P,null,C(s.value?n(t).users:b.value,x=>(o(),y(U,{key:x.discordUserId,user:x,"schedule-id":l.value,"total-days":n(t).scheduleStats?.dailyTasks},null,8,["user","schedule-id","total-days"]))),128))])])):p("",!0),n(t).users.length===0?(o(),c("div",pe,[r[5]||(r[5]=e("div",{class:"mb-4 flex justify-center"},[e("div",{class:"flex h-16 w-16 items-center justify-center rounded-2xl bg-slate-100 dark:bg-slate-700"},[e("i",{class:"bi bi-search text-3xl text-slate-400"})])],-1)),e("p",fe,g(s.value?"找不到符合的用戶":"尚無參與者"),1)])):p("",!0),n(t).pagination&&n(t).users.length>0?(o(),c("div",ke,[I(W,{pagination:n(t).pagination,onPageChange:_},null,8,["pagination"])])):p("",!0)],64))])]),_:1}))}});export{$e as default};
