import{B as N,r as m,l as _,d as $,u as B,q,c as x,C as S,a as l,F as M,z as V,p as w,b as U,n as y,t as D,o as p,m as P,y as F,R as H,D as G}from"./index-CV51tAj_.js";const E="https://message-tool-server.hexschool.io";async function b(t){const e=`${E}${t}`;let s;try{s=await fetch(e)}catch{throw new Error(`無法連接到 API 伺服器 (${E})`)}const i=s.headers.get("content-type");if(!i||!i.includes("application/json"))throw new Error("API 回應格式錯誤，請確認 API 伺服器是否正確運行");const a=await s.json();if(!s.ok)throw new Error(a.error?.message||`HTTP ${s.status}`);return a.data}const k={getStats(t){return b(`/api/checkin/${t}/stats`)},getUsers(t,e){const s=new URLSearchParams;e?.page&&s.set("page",String(e.page)),e?.limit&&s.set("limit",String(e.limit)),e?.search&&s.set("search",e.search);const i=s.toString();return b(`/api/checkin/${t}/users${i?`?${i}`:""}`)},getUserDetail(t,e){return b(`/api/checkin/${t}/users/${e}`)},getDayDetail(t,e){return b(`/api/checkin/${t}/days/${e}`)},searchUsers(t,e,s){const i=new URLSearchParams({q:e});return s&&i.set("limit",String(s)),b(`/api/checkin/${t}/search?${i}`)},getThreads(t){return b(`/api/checkin/${t}/threads`)}},J=N("checkin",()=>{const t=m(null),e=m([]),s=m(null),i=m(null),a=m(null),v=m([]),o=m(!1),n=m(null),f=_(()=>e.value.length>0),c=_(()=>a.value?.hasNextPage??!1);async function u(h){o.value=!0,n.value=null;try{t.value=await k.getStats(h)}catch(d){throw n.value=d instanceof Error?d.message:"取得統計資料失敗",d}finally{o.value=!1}}async function I(h,d){o.value=!0,n.value=null;try{const r=await k.getUsers(h,d);e.value=r.users,a.value=r.pagination}catch(r){throw n.value=r instanceof Error?r.message:"取得用戶列表失敗",r}finally{o.value=!1}}async function j(h,d){if(a.value?.hasNextPage){o.value=!0,n.value=null;try{const r=(a.value?.currentPage??0)+1,g=await k.getUsers(h,{...d,page:r});e.value=[...e.value,...g.users],a.value=g.pagination}catch(r){throw n.value=r instanceof Error?r.message:"載入更多用戶失敗",r}finally{o.value=!1}}}async function A(h,d){o.value=!0,n.value=null;try{s.value=await k.getUserDetail(h,d)}catch(r){throw n.value=r instanceof Error?r.message:"取得用戶詳情失敗",r}finally{o.value=!1}}async function C(h,d){o.value=!0,n.value=null;try{i.value=await k.getDayDetail(h,d)}catch(r){throw n.value=r instanceof Error?r.message:"取得單日詳情失敗",r}finally{o.value=!1}}async function L(h,d,r){o.value=!0,n.value=null;try{const g=await k.searchUsers(h,d,r);return v.value=g.results,g}catch(g){throw n.value=g instanceof Error?g.message:"搜尋用戶失敗",g}finally{o.value=!1}}function R(){n.value=null}function T(){v.value=[]}function z(){t.value=null,e.value=[],s.value=null,i.value=null,a.value=null,v.value=[],o.value=!1,n.value=null}return{scheduleStats:t,users:e,currentUser:s,currentDayDetail:i,pagination:a,searchResults:v,isLoading:o,error:n,hasUsers:f,hasMorePages:c,fetchScheduleStats:u,fetchUsers:I,fetchMoreUsers:j,fetchUserDetail:A,fetchDayDetail:C,searchUsers:L,clearError:R,clearSearchResults:T,$reset:z}}),K={class:"flex h-screen w-72 flex-col border-r border-slate-200 bg-white dark:border-slate-700 dark:bg-slate-900"},O={class:"flex-1 px-4"},Q={class:"space-y-2"},W={class:"px-4 pb-2"},X={class:"flex items-center gap-3"},Y={class:"relative h-6 w-11 rounded-full bg-slate-300 transition-colors dark:bg-violet-600"},Z={class:"border-t border-slate-200 p-4 dark:border-slate-700"},ee=["href"],te={key:1,class:"rounded-xl bg-gradient-to-r from-violet-50 to-indigo-50 p-4 dark:from-violet-900/30 dark:to-indigo-900/30"},se=$({__name:"AppSidebar",setup(t){const e=q(),s=B(),i=J(),a=_(()=>e.params.scheduleId),v=_(()=>{const f=i.scheduleStats?.dailyStats;if(!f||f.length===0)return null;const c=f[f.length-1];if(!c?.threadUrl)return null;const u=c.threadUrl.split("/");return u.length>1?(u.pop(),u.join("/")):c.threadUrl}),o=_(()=>[{name:"Dashboard",icon:"bi-grid-1x2-fill",to:{name:"dashboard",params:{scheduleId:a.value}}},{name:"打卡進度",icon:"bi-table",to:{name:"progress",params:{scheduleId:a.value}}},{name:"參與者",icon:"bi-people-fill",to:{name:"users",params:{scheduleId:a.value}}}]);function n(f){return e.name===f.name}return(f,c)=>(p(),x("aside",K,[c[3]||(c[3]=S('<div class="flex items-center gap-3 px-6 py-8"><div class="flex h-11 w-11 items-center justify-center rounded-xl bg-gradient-to-br from-violet-500 to-indigo-600 shadow-lg shadow-violet-500/30"><i class="bi bi-calendar2-check text-xl text-white"></i></div><div><h1 class="text-lg font-bold text-slate-800 dark:text-white">每日打卡</h1><p class="text-xs text-slate-400">Daily Check-in</p></div></div>',1)),l("nav",O,[l("ul",Q,[(p(!0),x(M,null,V(o.value,u=>(p(),x("li",{key:u.name},[P(w(H),{to:u.to,class:y(["group flex items-center gap-3 rounded-xl px-4 py-3 text-sm font-medium transition-all duration-200",n(u.to)?"bg-gradient-to-r from-violet-500 to-indigo-600 text-white shadow-lg shadow-violet-500/25":"text-slate-600 hover:bg-slate-100 hover:text-slate-900 dark:text-slate-300 dark:hover:bg-slate-800 dark:hover:text-white"])},{default:F(()=>[l("i",{class:y(["bi",u.icon,"text-lg transition-transform duration-200",n(u.to)?"":"group-hover:scale-110"])},null,2),U(" "+D(u.name),1)]),_:2},1032,["to","class"])]))),128))])]),l("div",W,[l("button",{class:"flex w-full items-center justify-between rounded-xl bg-slate-100 px-4 py-3 text-sm font-medium text-slate-600 transition-colors hover:bg-slate-200 dark:bg-slate-800 dark:text-slate-300 dark:hover:bg-slate-700",onClick:c[0]||(c[0]=u=>w(s).toggleTheme())},[l("span",X,[l("i",{class:y(["bi text-lg",w(s).theme==="dark"?"bi-moon-fill":"bi-sun-fill"])},null,2),U(" "+D(w(s).theme==="dark"?"深色模式":"淺色模式"),1)]),l("div",Y,[l("div",{class:y(["absolute top-0.5 h-5 w-5 rounded-full bg-white shadow-sm transition-transform",w(s).theme==="dark"?"translate-x-5":"translate-x-0.5"])},null,2)])])]),l("div",Z,[v.value?(p(),x("a",{key:0,href:v.value,target:"_blank",rel:"noopener noreferrer",class:"block rounded-xl bg-gradient-to-r from-violet-50 to-indigo-50 p-4 transition-all hover:from-violet-100 hover:to-indigo-100 dark:from-violet-900/30 dark:to-indigo-900/30 dark:hover:from-violet-900/50 dark:hover:to-indigo-900/50"},[...c[1]||(c[1]=[S('<div class="flex items-center gap-3"><div class="flex h-10 w-10 items-center justify-center rounded-lg bg-violet-100 dark:bg-violet-800"><i class="bi bi-discord text-lg text-violet-600 dark:text-violet-300"></i></div><div class="flex-1 min-w-0"><p class="text-sm font-medium text-slate-700 dark:text-slate-200">Discord 社群</p><p class="truncate text-xs text-slate-500 dark:text-slate-400">查看打卡討論</p></div><i class="bi bi-arrow-up-right text-slate-400"></i></div>',1)])],8,ee)):(p(),x("div",te,[...c[2]||(c[2]=[S('<div class="flex items-center gap-3"><div class="flex h-10 w-10 items-center justify-center rounded-lg bg-violet-100 dark:bg-violet-800"><i class="bi bi-discord text-lg text-violet-600 dark:text-violet-300"></i></div><div class="flex-1 min-w-0"><p class="text-sm font-medium text-slate-700 dark:text-slate-200">Discord 社群</p><p class="truncate text-xs text-slate-500 dark:text-slate-400">查看打卡討論</p></div></div>',1)])]))])]))}}),ae={class:"flex min-h-screen bg-slate-50 dark:bg-slate-950"},re={class:"flex-1 overflow-auto"},de=$({__name:"MainLayout",setup(t){return(e,s)=>(p(),x("div",ae,[P(se),l("main",re,[G(e.$slots,"default")])]))}}),le={class:"flex items-center justify-center"},he=$({__name:"LoadingSpinner",props:{size:{}},setup(t){return(e,s)=>(p(),x("div",le,[l("div",{class:y(["animate-spin rounded-full border-2 border-white/10 border-t-violet-500",{"h-4 w-4":t.size==="sm","h-8 w-8":t.size==="md"||!t.size,"h-12 w-12":t.size==="lg"}])},null,2)]))}}),ne={class:"rounded-2xl border border-rose-200 bg-rose-50 p-6 shadow-sm dark:border-rose-800 dark:bg-rose-900/30"},oe={class:"flex items-start gap-4"},ie={class:"flex-1 min-w-0"},ce={class:"mt-1 text-sm text-rose-600 dark:text-rose-300"},ve=$({__name:"ErrorMessage",props:{message:{}},emits:["retry"],setup(t,{emit:e}){const s=e;return(i,a)=>(p(),x("div",ne,[l("div",oe,[a[3]||(a[3]=l("div",{class:"flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-xl bg-rose-100 dark:bg-rose-900/50"},[l("i",{class:"bi bi-exclamation-triangle text-lg text-rose-600 dark:text-rose-400"})],-1)),l("div",ie,[a[2]||(a[2]=l("h3",{class:"font-semibold text-rose-800 dark:text-rose-200"},"發生錯誤",-1)),l("p",ce,D(t.message),1),l("button",{class:"mt-4 inline-flex items-center gap-2 rounded-lg bg-rose-100 px-4 py-2 text-sm font-medium text-rose-700 transition-colors hover:bg-rose-200 dark:bg-rose-900/50 dark:text-rose-300 dark:hover:bg-rose-800",onClick:a[0]||(a[0]=v=>s("retry"))},[...a[1]||(a[1]=[l("i",{class:"bi bi-arrow-clockwise"},null,-1),U(" 重試 ",-1)])])])])]))}});export{de as _,he as a,ve as b,k as c,J as u};
