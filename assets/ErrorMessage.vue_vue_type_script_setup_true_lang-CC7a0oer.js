import{C as I,r as m,c as _,d as S,x as q,z as P,A as F,T as A,w as U,D as G,E as H,y as h,b as e,a as p,f as J,F as K,h as D,i as y,t as j,o as b,g as E,R as Q,m as W,G as X,e as Y}from"./index-D4UaJTr1.js";const C="https://message-tool-server.hexschool.io";async function k(s){const t=`${C}${s}`;let r;try{r=await fetch(t)}catch{throw new Error(`無法連接到 API 伺服器 (${C})`)}const o=r.headers.get("content-type");if(!o||!o.includes("application/json"))throw new Error("API 回應格式錯誤，請確認 API 伺服器是否正確運行");const a=await r.json();if(!r.ok)throw new Error(a.error?.message||`HTTP ${r.status}`);return a.data}const w={getStats(s){return k(`/api/checkin/${s}/stats`)},getUsers(s,t){const r=new URLSearchParams;t?.page&&r.set("page",String(t.page)),t?.limit&&r.set("limit",String(t.limit)),t?.search&&r.set("search",t.search);const o=r.toString();return k(`/api/checkin/${s}/users${o?`?${o}`:""}`)},getUserDetail(s,t){return k(`/api/checkin/${s}/users/${t}`)},getDayDetail(s,t){return k(`/api/checkin/${s}/days/${t}`)},searchUsers(s,t,r){const o=new URLSearchParams({q:t});return r&&o.set("limit",String(r)),k(`/api/checkin/${s}/search?${o}`)},getThreads(s){return k(`/api/checkin/${s}/threads`)}},Z=I("checkin",()=>{const s=m(null),t=m([]),r=m(null),o=m(null),a=m(null),f=m([]),i=m(!1),c=m(null),$=_(()=>t.value.length>0),v=_(()=>a.value?.hasNextPage??!1);async function n(g){i.value=!0,c.value=null;try{s.value=await w.getStats(g)}catch(u){throw c.value=u instanceof Error?u.message:"取得統計資料失敗",u}finally{i.value=!1}}async function d(g,u){i.value=!0,c.value=null;try{const l=await w.getUsers(g,u);t.value=l.users,a.value=l.pagination}catch(l){throw c.value=l instanceof Error?l.message:"取得用戶列表失敗",l}finally{i.value=!1}}async function L(g,u){if(a.value?.hasNextPage){i.value=!0,c.value=null;try{const l=(a.value?.currentPage??0)+1,x=await w.getUsers(g,{...u,page:l});t.value=[...t.value,...x.users],a.value=x.pagination}catch(l){throw c.value=l instanceof Error?l.message:"載入更多用戶失敗",l}finally{i.value=!1}}}async function R(g,u){i.value=!0,c.value=null;try{r.value=await w.getUserDetail(g,u)}catch(l){throw c.value=l instanceof Error?l.message:"取得用戶詳情失敗",l}finally{i.value=!1}}async function M(g,u){i.value=!0,c.value=null;try{o.value=await w.getDayDetail(g,u)}catch(l){throw c.value=l instanceof Error?l.message:"取得單日詳情失敗",l}finally{i.value=!1}}async function N(g,u,l){i.value=!0,c.value=null;try{const x=await w.searchUsers(g,u,l);return f.value=x.results,x}catch(x){throw c.value=x instanceof Error?x.message:"搜尋用戶失敗",x}finally{i.value=!1}}function B(){c.value=null}function O(){f.value=[]}function V(){s.value=null,t.value=[],r.value=null,o.value=null,a.value=null,f.value=[],i.value=!1,c.value=null}return{scheduleStats:s,users:t,currentUser:r,currentDayDetail:o,pagination:a,searchResults:f,isLoading:i,error:c,hasUsers:$,hasMorePages:v,fetchScheduleStats:n,fetchUsers:d,fetchMoreUsers:L,fetchUserDetail:R,fetchDayDetail:M,searchUsers:N,clearError:B,clearSearchResults:O,$reset:V}}),z=I("sidebar",()=>{const s=m(!1);function t(){s.value=!0}function r(){s.value=!1}function o(){s.value=!s.value}return{isOpen:s,open:t,close:r,toggle:o}}),ee={class:"flex items-center justify-between px-6 py-8"},te={class:"flex-1 px-4"},se={class:"space-y-2"},ae={class:"px-4 pb-2"},re={class:"flex items-center gap-3"},le={class:"relative h-6 w-11 rounded-full bg-slate-300 transition-colors dark:bg-violet-600"},oe={class:"border-t border-slate-200 p-4 dark:border-slate-700"},ne=["href"],ie={key:1,class:"rounded-xl bg-gradient-to-r from-violet-50 to-indigo-50 p-4 dark:from-violet-900/30 dark:to-indigo-900/30"},ce=S({__name:"AppSidebar",setup(s){const t=P(),r=q(),o=Z(),a=z(),f=_(()=>t.params.scheduleId),i=_(()=>{const v=o.scheduleStats?.dailyStats;if(!v||v.length===0)return null;const n=v[v.length-1];if(!n?.threadUrl)return null;const d=n.threadUrl.split("/");return d.length>1?(d.pop(),d.join("/")):n.threadUrl}),c=_(()=>[{name:"Dashboard",icon:"bi-grid-1x2-fill",to:{name:"dashboard",params:{scheduleId:f.value}}},{name:"打卡進度",icon:"bi-table",to:{name:"progress",params:{scheduleId:f.value}}},{name:"參與者",icon:"bi-people-fill",to:{name:"users",params:{scheduleId:f.value}}}]);function $(v){return t.name===v.name}return(v,n)=>(b(),F(A,{name:"slide"},{default:U(()=>[G(e("aside",{class:y(["fixed inset-y-0 left-0 z-50 flex h-screen w-72 flex-col border-r border-slate-200 bg-white dark:border-slate-700 dark:bg-slate-900 lg:static lg:!flex",{"!flex":h(a).isOpen}])},[e("div",ee,[n[3]||(n[3]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"flex h-11 w-11 items-center justify-center rounded-xl bg-gradient-to-br from-violet-500 to-indigo-600 shadow-lg shadow-violet-500/30"},[e("i",{class:"bi bi-calendar2-check text-xl text-white"})]),e("div",null,[e("h1",{class:"text-lg font-bold text-slate-800 dark:text-white"},"每日打卡"),e("p",{class:"text-xs text-slate-400"},"Daily Check-in")])],-1)),e("button",{class:"flex h-9 w-9 items-center justify-center rounded-lg text-slate-500 transition-colors hover:bg-slate-100 hover:text-slate-700 dark:text-slate-400 dark:hover:bg-slate-800 dark:hover:text-slate-200 lg:hidden",onClick:n[0]||(n[0]=d=>h(a).close()),"aria-label":"關閉選單"},[...n[2]||(n[2]=[e("i",{class:"bi bi-x-lg text-xl"},null,-1)])])]),e("nav",te,[e("ul",se,[(b(!0),p(K,null,J(c.value,d=>(b(),p("li",{key:d.name},[E(h(Q),{to:d.to,class:y(["group flex items-center gap-3 rounded-xl px-4 py-3 text-sm font-medium transition-all duration-200",$(d.to)?"bg-gradient-to-r from-violet-500 to-indigo-600 text-white shadow-lg shadow-violet-500/25":"text-slate-600 hover:bg-slate-100 hover:text-slate-900 dark:text-slate-300 dark:hover:bg-slate-800 dark:hover:text-white"])},{default:U(()=>[e("i",{class:y(["bi",d.icon,"text-lg transition-transform duration-200",$(d.to)?"":"group-hover:scale-110"])},null,2),D(" "+j(d.name),1)]),_:2},1032,["to","class"])]))),128))])]),e("div",ae,[e("button",{class:"flex w-full items-center justify-between rounded-xl bg-slate-100 px-4 py-3 text-sm font-medium text-slate-600 transition-colors hover:bg-slate-200 dark:bg-slate-800 dark:text-slate-300 dark:hover:bg-slate-700",onClick:n[1]||(n[1]=d=>h(r).toggleTheme())},[e("span",re,[e("i",{class:y(["bi text-lg",h(r).theme==="dark"?"bi-moon-fill":"bi-sun-fill"])},null,2),D(" "+j(h(r).theme==="dark"?"深色模式":"淺色模式"),1)]),e("div",le,[e("div",{class:y(["absolute top-0.5 h-5 w-5 rounded-full bg-white shadow-sm transition-transform",h(r).theme==="dark"?"translate-x-5":"translate-x-0.5"])},null,2)])])]),e("div",oe,[i.value?(b(),p("a",{key:0,href:i.value,target:"_blank",rel:"noopener noreferrer",class:"block rounded-xl bg-gradient-to-r from-violet-50 to-indigo-50 p-4 transition-all hover:from-violet-100 hover:to-indigo-100 dark:from-violet-900/30 dark:to-indigo-900/30 dark:hover:from-violet-900/50 dark:hover:to-indigo-900/50"},[...n[4]||(n[4]=[e("div",{class:"flex items-center gap-3"},[e("div",{class:"flex h-10 w-10 items-center justify-center rounded-lg bg-violet-100 dark:bg-violet-800"},[e("i",{class:"bi bi-discord text-lg text-violet-600 dark:text-violet-300"})]),e("div",{class:"min-w-0 flex-1"},[e("p",{class:"text-sm font-medium text-slate-700 dark:text-slate-200"},"Discord 社群"),e("p",{class:"truncate text-xs text-slate-500 dark:text-slate-400"},"查看打卡討論")]),e("i",{class:"bi bi-arrow-up-right text-slate-400"})],-1)])],8,ne)):(b(),p("div",ie,[...n[5]||(n[5]=[e("div",{class:"flex items-center gap-3"},[e("div",{class:"flex h-10 w-10 items-center justify-center rounded-lg bg-violet-100 dark:bg-violet-800"},[e("i",{class:"bi bi-discord text-lg text-violet-600 dark:text-violet-300"})]),e("div",{class:"min-w-0 flex-1"},[e("p",{class:"text-sm font-medium text-slate-700 dark:text-slate-200"},"Discord 社群"),e("p",{class:"truncate text-xs text-slate-500 dark:text-slate-400"},"查看打卡討論")])],-1)])]))])],2),[[H,h(a).isOpen]])]),_:1}))}}),T=(s,t)=>{const r=s.__vccOpts||s;for(const[o,a]of t)r[o]=a;return r},de=T(ce,[["__scopeId","data-v-dabe2a99"]]),ue={class:"flex min-h-screen bg-slate-50 dark:bg-slate-950"},fe={class:"fixed left-0 right-0 top-0 z-40 flex h-16 items-center justify-between border-b border-slate-200 bg-white px-4 dark:border-slate-700 dark:bg-slate-900 lg:hidden"},ge={class:"flex-1 overflow-auto pt-16 lg:pt-0"},he=S({__name:"MainLayout",setup(s){const t=z(),r=P();return W(()=>r.path,()=>{t.close()}),(o,a)=>(b(),p("div",ue,[e("header",fe,[a[3]||(a[3]=e("div",{class:"flex items-center gap-3"},[e("div",{class:"flex h-9 w-9 items-center justify-center rounded-lg bg-gradient-to-br from-violet-500 to-indigo-600 shadow-lg shadow-violet-500/30"},[e("i",{class:"bi bi-calendar2-check text-white"})]),e("h1",{class:"text-lg font-bold text-slate-800 dark:text-white"},"每日打卡")],-1)),e("button",{class:"flex h-10 w-10 items-center justify-center rounded-lg text-slate-600 transition-colors hover:bg-slate-100 dark:text-slate-300 dark:hover:bg-slate-800",onClick:a[0]||(a[0]=f=>h(t).toggle()),"aria-label":"開啟選單"},[...a[2]||(a[2]=[e("i",{class:"bi bi-list text-2xl"},null,-1)])])]),E(A,{name:"fade"},{default:U(()=>[h(t).isOpen?(b(),p("div",{key:0,class:"fixed inset-0 z-40 bg-black/50 backdrop-blur-sm lg:hidden",onClick:a[1]||(a[1]=f=>h(t).close())})):Y("",!0)]),_:1}),E(de),e("main",ge,[X(o.$slots,"default",{},void 0)])]))}}),we=T(he,[["__scopeId","data-v-8491d30d"]]),ve={class:"flex items-center justify-center"},ye=S({__name:"LoadingSpinner",props:{size:{}},setup(s){return(t,r)=>(b(),p("div",ve,[e("div",{class:y(["animate-spin rounded-full border-2 border-white/10 border-t-violet-500",{"h-4 w-4":s.size==="sm","h-8 w-8":s.size==="md"||!s.size,"h-12 w-12":s.size==="lg"}])},null,2)]))}}),xe={class:"rounded-2xl border border-rose-200 bg-rose-50 p-6 shadow-sm dark:border-rose-800 dark:bg-rose-900/30"},me={class:"flex items-start gap-4"},be={class:"flex-1 min-w-0"},pe={class:"mt-1 text-sm text-rose-600 dark:text-rose-300"},_e=S({__name:"ErrorMessage",props:{message:{}},emits:["retry"],setup(s,{emit:t}){const r=t;return(o,a)=>(b(),p("div",xe,[e("div",me,[a[3]||(a[3]=e("div",{class:"flex h-10 w-10 flex-shrink-0 items-center justify-center rounded-xl bg-rose-100 dark:bg-rose-900/50"},[e("i",{class:"bi bi-exclamation-triangle text-lg text-rose-600 dark:text-rose-400"})],-1)),e("div",be,[a[2]||(a[2]=e("h3",{class:"font-semibold text-rose-800 dark:text-rose-200"},"發生錯誤",-1)),e("p",pe,j(s.message),1),e("button",{class:"mt-4 inline-flex items-center gap-2 rounded-lg bg-rose-100 px-4 py-2 text-sm font-medium text-rose-700 transition-colors hover:bg-rose-200 dark:bg-rose-900/50 dark:text-rose-300 dark:hover:bg-rose-800",onClick:a[0]||(a[0]=f=>r("retry"))},[...a[1]||(a[1]=[e("i",{class:"bi bi-arrow-clockwise"},null,-1),D(" 重試 ",-1)])])])])]))}});export{we as M,T as _,ye as a,_e as b,w as c,Z as u};
