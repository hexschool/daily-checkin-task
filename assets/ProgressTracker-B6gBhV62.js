import{d as $,l as _,q as R,r as T,f as B,x as y,y as w,A as V,o as l,a as e,c as a,p as o,m as U,F as m,e as k,b as u,t as r,z as h,R as j,n as z}from"./index-i7JgcKla.js";import{u as A,_ as q,a as N,b as E}from"./ErrorMessage.vue_vue_type_script_setup_true_lang-DUIIj3cc.js";import{u as F}from"./pinned-C5ZTmzdx.js";const X={class:"p-8"},G={key:0,class:"flex h-96 items-center justify-center"},H={key:0,class:"mb-6 flex flex-wrap items-center gap-6"},J={class:"flex items-center gap-2"},K={class:"text-sm text-slate-600 dark:text-slate-400"},O={class:"text-slate-800 dark:text-white"},Q={class:"flex items-center gap-2"},W={class:"text-sm text-slate-600 dark:text-slate-400"},Y={class:"text-slate-800 dark:text-white"},Z={class:"flex items-center gap-2"},ee={class:"text-sm text-slate-600 dark:text-slate-400"},te={class:"text-slate-800 dark:text-white"},se={key:1,class:"mb-6"},le={class:"mb-3 flex items-center gap-2"},ae={class:"text-sm font-semibold text-slate-700 dark:text-slate-300"},ie={class:"overflow-hidden rounded-2xl border-2 border-violet-200 bg-white shadow-sm dark:border-violet-800 dark:bg-slate-800"},oe={class:"overflow-x-auto"},re={class:"w-full"},de={class:"border-b border-violet-100 bg-violet-50 dark:border-violet-800 dark:bg-violet-900/30"},ne={class:"divide-y divide-violet-100 dark:divide-violet-800"},ce=["onClick"],xe={class:"sticky left-0 z-10 w-[200px] min-w-[200px] max-w-[200px] px-4 py-3"},ue={class:"flex items-center gap-2"},me=["onClick"],be=["src","alt"],ve={class:"min-w-0 flex-1"},he={class:"truncate text-sm font-medium text-slate-800 dark:text-white"},ke={class:"truncate text-xs text-slate-500 dark:text-slate-400"},pe={key:0,class:"inline-flex h-6 w-6 items-center justify-center rounded-lg bg-emerald-100 text-emerald-600 dark:bg-emerald-900/50 dark:text-emerald-400"},ge={key:1,class:"inline-flex h-6 w-6 items-center justify-center rounded-lg bg-slate-100 text-slate-400 dark:bg-slate-700 dark:text-slate-500"},fe={class:"overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-700 dark:bg-slate-800"},_e={class:"overflow-x-auto"},ye={class:"w-full"},we={class:"border-b border-slate-200 bg-slate-50 dark:border-slate-700 dark:bg-slate-900"},Ue={class:"divide-y divide-slate-100 dark:divide-slate-700"},Ie=["onClick"],Pe={class:"sticky left-0 z-10 w-[200px] min-w-[200px] max-w-[200px] px-4 py-3"},Ce={class:"flex items-center gap-2"},Se=["title","disabled","onClick"],je=["src","alt"],ze={class:"min-w-0 flex-1"},Ne={class:"truncate text-sm font-medium text-slate-800 dark:text-white"},Le={class:"truncate text-xs text-slate-500 dark:text-slate-400"},De={key:0,class:"inline-flex h-6 w-6 items-center justify-center rounded-lg bg-emerald-100 text-emerald-600 dark:bg-emerald-900/50 dark:text-emerald-400"},Me={key:1,class:"inline-flex h-6 w-6 items-center justify-center rounded-lg bg-slate-100 text-slate-400 dark:bg-slate-700 dark:text-slate-500"},$e={key:0,class:"border-t border-slate-200 p-4 text-center dark:border-slate-700"},Re=["disabled"],Te={key:2,class:"rounded-2xl border border-slate-200 bg-white py-16 text-center shadow-sm dark:border-slate-700 dark:bg-slate-800"},Ee=$({__name:"ProgressTracker",setup(Be){const L=R(),D=V(),i=A(),x=F(),d=_(()=>L.params.scheduleId),b=T(!1),v=_(()=>i.scheduleStats?.dailyStats?i.scheduleStats.dailyStats.map(c=>c.dayLabel):[]),g=_(()=>x.getPinnedUserList(d.value));async function I(){i.scheduleStats||await i.fetchScheduleStats(d.value),await Promise.all([i.fetchUsers(d.value,{limit:50}),x.fetchPinnedUsers(d.value)])}async function M(){b.value||!i.hasMorePages||(b.value=!0,await i.fetchMoreUsers(d.value,{limit:50}),b.value=!1)}function P(c){D.push({name:"user-detail",params:{scheduleId:d.value,discordUserId:c}})}function C(c){return`https://cdn.discordapp.com/embed/avatars/${parseInt(c)%5}.png`}function S(c,t){t.stopPropagation();const s=x.isPinned(d.value,c),n=x.togglePin(d.value,c);!s&&n&&x.fetchPinnedUsers(d.value)}function p(c){return x.isPinned(d.value,c)}function f(){return x.canPin(d.value)}return B(()=>{I()}),(c,t)=>(l(),y(q,null,{default:w(()=>[e("div",X,[t[18]||(t[18]=e("div",{class:"mb-8"},[e("h1",{class:"text-2xl font-bold text-slate-800 dark:text-white"},"打卡進度追蹤"),e("p",{class:"mt-1 text-slate-500 dark:text-slate-400"},"查看所有參與者的打卡狀況")],-1)),o(i).isLoading&&o(i).users.length===0?(l(),a("div",G,[U(N,{size:"lg"})])):o(i).error?(l(),y(E,{key:1,message:o(i).error,onRetry:I},null,8,["message"])):(l(),a(m,{key:2},[o(i).scheduleStats?(l(),a("div",H,[e("div",J,[t[1]||(t[1]=e("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-violet-100 dark:bg-violet-900/50"},[e("i",{class:"bi bi-people-fill text-sm text-violet-600 dark:text-violet-400"})],-1)),e("span",K,[e("strong",O,r(o(i).scheduleStats.uniqueUsers),1),t[0]||(t[0]=u(" 位參與者 ",-1))])]),e("div",Q,[t[4]||(t[4]=e("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-emerald-100 dark:bg-emerald-900/50"},[e("i",{class:"bi bi-calendar-check text-sm text-emerald-600 dark:text-emerald-400"})],-1)),e("span",W,[t[2]||(t[2]=u(" 累計 ",-1)),e("strong",Y,r(o(i).scheduleStats.dailyTasks),1),t[3]||(t[3]=u(" 天 ",-1))])]),e("div",Z,[t[7]||(t[7]=e("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-amber-100 dark:bg-amber-900/50"},[e("i",{class:"bi bi-check2-all text-sm text-amber-600 dark:text-amber-400"})],-1)),e("span",ee,[t[5]||(t[5]=u(" 總打卡 ",-1)),e("strong",te,r(o(i).scheduleStats.totalCheckins),1),t[6]||(t[6]=u(" 次 ",-1))])])])):k("",!0),g.value.length>0?(l(),a("div",se,[e("div",le,[t[8]||(t[8]=e("i",{class:"bi bi-pin-fill text-violet-500"},null,-1)),e("h2",ae," 釘選用戶 ("+r(g.value.length)+"/"+r(o(x).MAX_PINNED)+") ",1)]),e("div",ie,[e("div",oe,[e("table",re,[e("thead",null,[e("tr",de,[t[9]||(t[9]=e("th",{class:"sticky left-0 z-10 w-[200px] min-w-[200px] max-w-[200px] bg-violet-50 px-4 py-3 text-left text-sm font-semibold text-slate-700 dark:bg-violet-900/30 dark:text-slate-200"}," 參與者 ",-1)),(l(!0),a(m,null,h(v.value,s=>(l(),a("th",{key:s,class:"px-2 py-3 text-center text-xs font-medium whitespace-nowrap"},[U(o(j),{to:{name:"day-detail",params:{scheduleId:d.value,dayLabel:s}},class:"text-slate-500 transition-colors hover:text-slate-800 dark:text-slate-400 dark:hover:text-slate-200"},{default:w(()=>[u(r(s),1)]),_:2},1032,["to"])]))),128))])]),e("tbody",ne,[(l(!0),a(m,null,h(g.value,s=>(l(),a("tr",{key:s.discordUserId,class:"cursor-pointer transition-colors hover:bg-violet-50 dark:hover:bg-violet-900/20",onClick:n=>P(s.discordUserId)},[e("td",xe,[e("div",ue,[e("button",{class:"flex-shrink-0 rounded-lg p-1.5 text-violet-500 transition-colors hover:bg-violet-100 dark:hover:bg-violet-900/50",title:"取消釘選",onClick:n=>S(s.discordUserId,n)},[...t[10]||(t[10]=[e("i",{class:"bi bi-pin-fill text-sm"},null,-1)])],8,me),e("img",{src:s.avatarUrl||C(s.discordUserId),alt:s.displayName,class:"h-8 w-8 flex-shrink-0 rounded-full object-cover ring-2 ring-violet-100 dark:ring-violet-800",loading:"lazy"},null,8,be),e("div",ve,[e("p",he,r(s.displayName),1),e("p",ke,r(s.totalCheckinDays)+" / "+r(v.value.length)+" 天 ",1)])])]),(l(!0),a(m,null,h(v.value,n=>(l(),a("td",{key:n,class:"px-2 py-3 text-center"},[s.checkinStatus[n]?(l(),a("span",pe,[...t[11]||(t[11]=[e("i",{class:"bi bi-check-lg text-sm"},null,-1)])])):(l(),a("span",ge,[...t[12]||(t[12]=[e("i",{class:"bi bi-dash text-sm"},null,-1)])]))]))),128))],8,ce))),128))])])])])])):k("",!0),t[17]||(t[17]=e("div",{class:"mb-3 flex items-center gap-2"},[e("i",{class:"bi bi-list-ul text-slate-500"}),e("h2",{class:"text-sm font-semibold text-slate-700 dark:text-slate-300"},"所有參與者")],-1)),e("div",fe,[e("div",_e,[e("table",ye,[e("thead",null,[e("tr",we,[t[13]||(t[13]=e("th",{class:"sticky left-0 z-10 w-[200px] min-w-[200px] max-w-[200px] bg-slate-50 px-4 py-3 text-left text-sm font-semibold text-slate-700 dark:bg-slate-900 dark:text-slate-200"}," 參與者 ",-1)),(l(!0),a(m,null,h(v.value,s=>(l(),a("th",{key:s,class:"px-2 py-3 text-center text-xs font-medium whitespace-nowrap"},[U(o(j),{to:{name:"day-detail",params:{scheduleId:d.value,dayLabel:s}},class:"text-slate-500 transition-colors hover:text-slate-800 dark:text-slate-400 dark:hover:text-slate-200"},{default:w(()=>[u(r(s),1)]),_:2},1032,["to"])]))),128))])]),e("tbody",Ue,[(l(!0),a(m,null,h(o(i).users,s=>(l(),a("tr",{key:s.discordUserId,class:"cursor-pointer transition-colors hover:bg-slate-50 dark:hover:bg-slate-700/50",onClick:n=>P(s.discordUserId)},[e("td",Pe,[e("div",Ce,[e("button",{class:z(["flex-shrink-0 rounded-lg p-1.5 transition-colors",p(s.discordUserId)?"text-violet-500 hover:bg-violet-100 dark:hover:bg-violet-900/50":f()?"text-slate-400 hover:bg-slate-100 hover:text-violet-500 dark:hover:bg-slate-700":"cursor-not-allowed text-slate-300 dark:text-slate-600"]),title:p(s.discordUserId)?"取消釘選":f()?"釘選用戶":"已達釘選上限",disabled:!p(s.discordUserId)&&!f(),onClick:n=>S(s.discordUserId,n)},[e("i",{class:z(["bi text-sm",p(s.discordUserId)?"bi-pin-fill":"bi-pin"])},null,2)],10,Se),e("img",{src:s.avatarUrl||C(s.discordUserId),alt:s.displayName,class:"h-8 w-8 flex-shrink-0 rounded-full object-cover ring-2 ring-slate-100 dark:ring-slate-700",loading:"lazy"},null,8,je),e("div",ze,[e("p",Ne,r(s.displayName),1),e("p",Le,r(s.totalCheckinDays)+" / "+r(v.value.length)+" 天 ",1)])])]),(l(!0),a(m,null,h(v.value,n=>(l(),a("td",{key:n,class:"px-2 py-3 text-center"},[s.checkinStatus[n]?(l(),a("span",De,[...t[14]||(t[14]=[e("i",{class:"bi bi-check-lg text-sm"},null,-1)])])):(l(),a("span",Me,[...t[15]||(t[15]=[e("i",{class:"bi bi-dash text-sm"},null,-1)])]))]))),128))],8,Ie))),128))])])]),o(i).hasMorePages?(l(),a("div",$e,[e("button",{class:"inline-flex items-center gap-2 rounded-xl bg-violet-600 px-5 py-2.5 text-sm font-medium text-white shadow-sm transition-all hover:bg-violet-700 disabled:opacity-50",disabled:b.value,onClick:M},[b.value?(l(),y(N,{key:0,size:"sm"})):k("",!0),u(" "+r(b.value?"載入中...":"載入更多"),1)],8,Re)])):k("",!0)]),o(i).users.length===0?(l(),a("div",Te,[...t[16]||(t[16]=[e("div",{class:"mb-4 flex justify-center"},[e("div",{class:"flex h-16 w-16 items-center justify-center rounded-2xl bg-slate-100 dark:bg-slate-700"},[e("i",{class:"bi bi-people text-3xl text-slate-400"})])],-1),e("p",{class:"text-slate-500 dark:text-slate-400"},"尚無參與者資料",-1)])])):k("",!0)],64))])]),_:1}))}});export{Ee as default};
