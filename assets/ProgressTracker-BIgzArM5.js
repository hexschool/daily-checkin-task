import{d as R,c as y,z as T,r as $,k as V,A as w,w as U,B as A,o as l,b as t,a,e as h,y as r,g as I,F as b,h as u,t as o,f as v,R as j,i as L}from"./index-DmIcfvM4.js";import{u as E,M as F,a as N,b as q}from"./ErrorMessage.vue_vue_type_script_setup_true_lang-DgRYiN8i.js";import{u as X}from"./pinned-D7NuQ650.js";const G={class:"p-8"},H={key:0,class:"flex h-96 items-center justify-center"},J={class:"mb-6 hidden flex-wrap items-center gap-6"},K={class:"flex items-center gap-2"},O={class:"text-sm text-slate-600 dark:text-slate-400"},Q={class:"text-slate-800 dark:text-white"},W={class:"flex items-center gap-2"},Y={class:"text-sm text-slate-600 dark:text-slate-400"},Z={class:"text-slate-800 dark:text-white"},tt={class:"flex items-center gap-2"},et={class:"text-sm text-slate-600 dark:text-slate-400"},st={class:"text-slate-800 dark:text-white"},lt={key:0,class:"mb-6"},at={class:"mb-3 flex items-center gap-2"},it={class:"text-sm font-semibold text-slate-700 dark:text-slate-300"},ot={class:"overflow-hidden rounded-2xl border-2 border-violet-200 bg-white shadow-sm dark:border-violet-800 dark:bg-slate-800"},rt={class:"overflow-x-auto"},dt={class:"w-full"},nt={class:"border-b border-violet-100 bg-violet-50 dark:border-violet-800 dark:bg-violet-900/30"},ct={class:"divide-y divide-violet-100 dark:divide-violet-800"},xt=["onClick"],ut={class:"sticky left-0 z-10 w-10 min-w-10 bg-white px-2 py-3 text-center text-sm text-slate-500 transition-colors group-hover:bg-violet-50 dark:bg-slate-800 dark:text-slate-400 dark:group-hover:bg-violet-900/20"},bt={class:"sticky left-10 z-10 w-50 min-w-50 max-w-50 bg-white px-4 py-3 transition-colors group-hover:bg-violet-50 dark:bg-slate-800 dark:group-hover:bg-violet-900/20"},mt={class:"flex items-center gap-2"},gt=["onClick"],vt=["src","alt"],kt={class:"min-w-0 flex-1"},ht={class:"truncate text-sm font-medium text-slate-800 dark:text-white"},pt={class:"truncate text-xs text-slate-500 dark:text-slate-400"},ft={key:0,class:"inline-flex h-6 w-6 items-center justify-center rounded-lg bg-emerald-100 text-emerald-600 dark:bg-emerald-900/50 dark:text-emerald-400"},_t={key:1,class:"inline-flex h-6 w-6 items-center justify-center rounded-lg bg-slate-100 text-slate-400 dark:bg-slate-700 dark:text-slate-500"},yt={class:"overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-700 dark:bg-slate-800"},wt={class:"overflow-x-auto"},Ut={class:"w-full"},It={class:"border-b border-slate-200 bg-slate-50 dark:border-slate-700 dark:bg-slate-900"},Pt={class:"divide-y divide-slate-100 dark:divide-slate-700"},St=["onClick"],Ct={class:"sticky left-0 z-10 w-10 min-w-10 bg-white px-2 py-3 text-center text-sm text-slate-500 transition-colors group-hover:bg-slate-50 dark:bg-slate-800 dark:text-slate-400 dark:group-hover:bg-slate-700/50"},zt={class:"sticky left-10 z-10 w-50 min-w-50 max-w-50 bg-white px-4 py-3 transition-colors group-hover:bg-slate-50 dark:bg-slate-800 dark:group-hover:bg-slate-700/50"},jt={class:"flex items-center gap-2"},Lt=["title","disabled","onClick"],Nt=["src","alt"],Mt={class:"min-w-0 flex-1"},Dt={class:"truncate text-sm font-medium text-slate-800 dark:text-white"},Bt={class:"truncate text-xs text-slate-500 dark:text-slate-400"},Rt={key:0,class:"inline-flex h-6 w-6 items-center justify-center rounded-lg bg-emerald-100 text-emerald-600 dark:bg-emerald-900/50 dark:text-emerald-400"},Tt={key:1,class:"inline-flex h-6 w-6 items-center justify-center rounded-lg bg-slate-100 text-slate-400 dark:bg-slate-700 dark:text-slate-500"},$t={key:0,class:"border-t border-slate-200 p-4 text-center dark:border-slate-700"},Vt=["disabled"],At={key:1,class:"rounded-2xl border border-slate-200 bg-white py-16 text-center shadow-sm dark:border-slate-700 dark:bg-slate-800"},Gt=R({__name:"ProgressTracker",setup(Et){const M=T(),D=A(),i=E(),x=X(),d=y(()=>M.params.scheduleId),m=$(!1),g=y(()=>i.scheduleStats?.dailyStats?i.scheduleStats.dailyStats.map(n=>n.dayLabel):[]),f=y(()=>x.getPinnedUserList(d.value));async function P(){i.scheduleStats||await i.fetchScheduleStats(d.value),await Promise.all([i.fetchUsers(d.value,{limit:50}),x.fetchPinnedUsers(d.value)])}async function B(){m.value||!i.hasMorePages||(m.value=!0,await i.fetchMoreUsers(d.value,{limit:50}),m.value=!1)}function S(n){D.push({name:"user-detail",params:{scheduleId:d.value,discordUserId:n}})}function C(n){return`https://cdn.discordapp.com/embed/avatars/${parseInt(n)%5}.png`}function z(n,e){e.stopPropagation();const s=x.isPinned(d.value,n),k=x.togglePin(d.value,n);!s&&k&&x.fetchPinnedUsers(d.value)}function p(n){return x.isPinned(d.value,n)}function _(){return x.canPin(d.value)}return V(()=>{P()}),(n,e)=>(l(),w(F,null,{default:U(()=>[t("div",G,[e[20]||(e[20]=t("div",{class:"mb-8"},[t("h1",{class:"text-2xl font-bold text-slate-800 dark:text-white"},"打卡進度追蹤"),t("p",{class:"mt-1 text-slate-500 dark:text-slate-400"},"查看所有參與者的打卡狀況")],-1)),r(i).isLoading&&!r(i).scheduleStats?(l(),a("div",H,[I(N,{size:"lg"})])):r(i).error?(l(),w(q,{key:1,message:r(i).error,onRetry:P},null,8,["message"])):r(i).scheduleStats?(l(),a(b,{key:2},[t("div",J,[t("div",K,[e[1]||(e[1]=t("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-violet-100 dark:bg-violet-900/50"},[t("i",{class:"bi bi-people-fill text-sm text-violet-600 dark:text-violet-400"})],-1)),t("span",O,[t("strong",Q,o(r(i).scheduleStats.uniqueUsers),1),e[0]||(e[0]=u(" 位參與者 ",-1))])]),t("div",W,[e[4]||(e[4]=t("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-emerald-100 dark:bg-emerald-900/50"},[t("i",{class:"bi bi-calendar-check text-sm text-emerald-600 dark:text-emerald-400"})],-1)),t("span",Y,[e[2]||(e[2]=u(" 累計 ",-1)),t("strong",Z,o(r(i).scheduleStats.dailyTasks),1),e[3]||(e[3]=u(" 天 ",-1))])]),t("div",tt,[e[7]||(e[7]=t("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-amber-100 dark:bg-amber-900/50"},[t("i",{class:"bi bi-check2-all text-sm text-amber-600 dark:text-amber-400"})],-1)),t("span",et,[e[5]||(e[5]=u(" 總打卡 ",-1)),t("strong",st,o(r(i).scheduleStats.totalCheckins),1),e[6]||(e[6]=u(" 次 ",-1))])])]),f.value.length>0?(l(),a("div",lt,[t("div",at,[e[8]||(e[8]=t("i",{class:"bi bi-pin-fill text-violet-500"},null,-1)),t("h2",it," 釘選用戶 ("+o(f.value.length)+"/"+o(r(x).MAX_PINNED)+") ",1)]),t("div",ot,[t("div",rt,[t("table",dt,[t("thead",null,[t("tr",nt,[e[9]||(e[9]=t("th",{class:"sticky left-0 z-10 w-10 min-w-10 bg-violet-50 px-2 py-3 text-center text-sm font-semibold text-slate-700 dark:bg-violet-900/30 dark:text-slate-200"}," # ",-1)),e[10]||(e[10]=t("th",{class:"sticky left-10 z-10 w-50 min-w-50 max-w-50 bg-violet-50 px-4 py-3 text-left text-sm font-semibold text-slate-700 dark:bg-violet-900/30 dark:text-slate-200"}," 參與者 ",-1)),(l(!0),a(b,null,v(g.value,s=>(l(),a("th",{key:s,class:"px-2 py-3 text-center text-xs font-medium whitespace-nowrap"},[I(r(j),{to:{name:"day-detail",params:{scheduleId:d.value,dayLabel:s}},class:"text-slate-500 transition-colors hover:text-slate-800 dark:text-slate-400 dark:hover:text-slate-200"},{default:U(()=>[u(o(s),1)]),_:2},1032,["to"])]))),128))])]),t("tbody",ct,[(l(!0),a(b,null,v(f.value,(s,k)=>(l(),a("tr",{key:s.discordUserId,class:"group cursor-pointer transition-colors hover:bg-violet-50 dark:hover:bg-violet-900/20",onClick:c=>S(s.discordUserId)},[t("td",ut,o(k+1),1),t("td",bt,[t("div",mt,[t("button",{class:"flex-shrink-0 rounded-lg p-1.5 text-violet-500 transition-colors hover:bg-violet-100 dark:hover:bg-violet-900/50",title:"取消釘選",onClick:c=>z(s.discordUserId,c)},[...e[11]||(e[11]=[t("i",{class:"bi bi-pin-fill text-sm"},null,-1)])],8,gt),t("img",{src:s.avatarUrl||C(s.discordUserId),alt:s.displayName,class:"h-8 w-8 flex-shrink-0 rounded-full object-cover ring-2 ring-violet-100 dark:ring-violet-800",loading:"lazy"},null,8,vt),t("div",kt,[t("p",ht,o(s.displayName),1),t("p",pt,o(s.totalCheckinDays)+" / "+o(g.value.length)+" 天 ",1)])])]),(l(!0),a(b,null,v(g.value,c=>(l(),a("td",{key:c,class:"px-2 py-3 text-center"},[s.checkinStatus[c]?(l(),a("span",ft,[...e[12]||(e[12]=[t("i",{class:"bi bi-check-lg text-sm"},null,-1)])])):(l(),a("span",_t,[...e[13]||(e[13]=[t("i",{class:"bi bi-dash text-sm"},null,-1)])]))]))),128))],8,xt))),128))])])])])])):h("",!0),e[19]||(e[19]=t("div",{class:"mb-3 flex items-center gap-2"},[t("i",{class:"bi bi-list-ul text-slate-500"}),t("h2",{class:"text-sm font-semibold text-slate-700 dark:text-slate-300"},"所有參與者")],-1)),t("div",yt,[t("div",wt,[t("table",Ut,[t("thead",null,[t("tr",It,[e[14]||(e[14]=t("th",{class:"sticky left-0 z-10 w-10 min-w-10 bg-slate-50 px-2 py-3 text-center text-sm font-semibold text-slate-700 dark:bg-slate-900 dark:text-slate-200"}," # ",-1)),e[15]||(e[15]=t("th",{class:"sticky left-10 z-10 w-50 min-w-50 max-w-50 bg-slate-50 px-4 py-3 text-left text-sm font-semibold text-slate-700 dark:bg-slate-900 dark:text-slate-200"}," 參與者 ",-1)),(l(!0),a(b,null,v(g.value,s=>(l(),a("th",{key:s,class:"px-2 py-3 text-center text-xs font-medium whitespace-nowrap"},[I(r(j),{to:{name:"day-detail",params:{scheduleId:d.value,dayLabel:s}},class:"text-slate-500 transition-colors hover:text-slate-800 dark:text-slate-400 dark:hover:text-slate-200"},{default:U(()=>[u(o(s),1)]),_:2},1032,["to"])]))),128))])]),t("tbody",Pt,[(l(!0),a(b,null,v(r(i).users,(s,k)=>(l(),a("tr",{key:s.discordUserId,class:"group cursor-pointer transition-colors hover:bg-slate-50 dark:hover:bg-slate-700/50",onClick:c=>S(s.discordUserId)},[t("td",Ct,o(k+1),1),t("td",zt,[t("div",jt,[t("button",{class:L(["flex-shrink-0 rounded-lg p-1.5 transition-colors",p(s.discordUserId)?"text-violet-500 hover:bg-violet-100 dark:hover:bg-violet-900/50":_()?"text-slate-400 hover:bg-slate-100 hover:text-violet-500 dark:hover:bg-slate-700":"cursor-not-allowed text-slate-300 dark:text-slate-600"]),title:p(s.discordUserId)?"取消釘選":_()?"釘選用戶":"已達釘選上限",disabled:!p(s.discordUserId)&&!_(),onClick:c=>z(s.discordUserId,c)},[t("i",{class:L(["bi text-sm",p(s.discordUserId)?"bi-pin-fill":"bi-pin"])},null,2)],10,Lt),t("img",{src:s.avatarUrl||C(s.discordUserId),alt:s.displayName,class:"h-8 w-8 flex-shrink-0 rounded-full object-cover ring-2 ring-slate-100 dark:ring-slate-700",loading:"lazy"},null,8,Nt),t("div",Mt,[t("p",Dt,o(s.displayName),1),t("p",Bt,o(s.totalCheckinDays)+" / "+o(g.value.length)+" 天 ",1)])])]),(l(!0),a(b,null,v(g.value,c=>(l(),a("td",{key:c,class:"px-2 py-3 text-center"},[s.checkinStatus[c]?(l(),a("span",Rt,[...e[16]||(e[16]=[t("i",{class:"bi bi-check-lg text-sm"},null,-1)])])):(l(),a("span",Tt,[...e[17]||(e[17]=[t("i",{class:"bi bi-dash text-sm"},null,-1)])]))]))),128))],8,St))),128))])])]),r(i).hasMorePages?(l(),a("div",$t,[t("button",{class:"inline-flex items-center gap-2 rounded-xl bg-violet-600 px-5 py-2.5 text-sm font-medium text-white shadow-sm transition-all hover:bg-violet-700 disabled:opacity-50",disabled:m.value,onClick:B},[m.value?(l(),w(N,{key:0,size:"sm"})):h("",!0),u(" "+o(m.value?"載入中...":"載入更多"),1)],8,Vt)])):h("",!0)]),r(i).users.length===0?(l(),a("div",At,[...e[18]||(e[18]=[t("div",{class:"mb-4 flex justify-center"},[t("div",{class:"flex h-16 w-16 items-center justify-center rounded-2xl bg-slate-100 dark:bg-slate-700"},[t("i",{class:"bi bi-people text-3xl text-slate-400"})])],-1),t("p",{class:"text-slate-500 dark:text-slate-400"},"尚無參與者資料",-1)])])):h("",!0)],64)):h("",!0)])]),_:1}))}});export{Gt as default};
