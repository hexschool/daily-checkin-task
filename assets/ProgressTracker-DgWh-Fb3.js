import{d as B,c as _,z as R,r as T,k as $,A as y,w,B as V,o as l,b as t,a,e as k,y as o,g as U,F as m,h as u,t as r,f as h,R as j,i as z}from"./index-D4UaJTr1.js";import{u as A,M as E,a as L,b as F}from"./ErrorMessage.vue_vue_type_script_setup_true_lang-CC7a0oer.js";import{u as q}from"./pinned-Df36pIPv.js";const X={class:"p-8"},G={key:0,class:"flex h-96 items-center justify-center"},H={class:"mb-6 hidden flex-wrap items-center gap-6"},J={class:"flex items-center gap-2"},K={class:"text-sm text-slate-600 dark:text-slate-400"},O={class:"text-slate-800 dark:text-white"},Q={class:"flex items-center gap-2"},W={class:"text-sm text-slate-600 dark:text-slate-400"},Y={class:"text-slate-800 dark:text-white"},Z={class:"flex items-center gap-2"},tt={class:"text-sm text-slate-600 dark:text-slate-400"},et={class:"text-slate-800 dark:text-white"},st={key:0,class:"mb-6"},lt={class:"mb-3 flex items-center gap-2"},at={class:"text-sm font-semibold text-slate-700 dark:text-slate-300"},it={class:"overflow-hidden rounded-2xl border-2 border-violet-200 bg-white shadow-sm dark:border-violet-800 dark:bg-slate-800"},ot={class:"overflow-x-auto"},rt={class:"w-full"},dt={class:"border-b border-violet-100 bg-violet-50 dark:border-violet-800 dark:bg-violet-900/30"},nt={class:"divide-y divide-violet-100 dark:divide-violet-800"},ct=["onClick"],xt={class:"sticky left-0 z-10 w-[200px] min-w-[200px] max-w-[200px] px-4 py-3"},ut={class:"flex items-center gap-2"},mt=["onClick"],bt=["src","alt"],vt={class:"min-w-0 flex-1"},ht={class:"truncate text-sm font-medium text-slate-800 dark:text-white"},kt={class:"truncate text-xs text-slate-500 dark:text-slate-400"},pt={key:0,class:"inline-flex h-6 w-6 items-center justify-center rounded-lg bg-emerald-100 text-emerald-600 dark:bg-emerald-900/50 dark:text-emerald-400"},gt={key:1,class:"inline-flex h-6 w-6 items-center justify-center rounded-lg bg-slate-100 text-slate-400 dark:bg-slate-700 dark:text-slate-500"},ft={class:"overflow-hidden rounded-2xl border border-slate-200 bg-white shadow-sm dark:border-slate-700 dark:bg-slate-800"},_t={class:"overflow-x-auto"},yt={class:"w-full"},wt={class:"border-b border-slate-200 bg-slate-50 dark:border-slate-700 dark:bg-slate-900"},Ut={class:"divide-y divide-slate-100 dark:divide-slate-700"},It=["onClick"],Pt={class:"sticky left-0 z-10 w-[200px] min-w-[200px] max-w-[200px] px-4 py-3"},St={class:"flex items-center gap-2"},Ct=["title","disabled","onClick"],jt=["src","alt"],zt={class:"min-w-0 flex-1"},Lt={class:"truncate text-sm font-medium text-slate-800 dark:text-white"},Nt={class:"truncate text-xs text-slate-500 dark:text-slate-400"},Mt={key:0,class:"inline-flex h-6 w-6 items-center justify-center rounded-lg bg-emerald-100 text-emerald-600 dark:bg-emerald-900/50 dark:text-emerald-400"},Dt={key:1,class:"inline-flex h-6 w-6 items-center justify-center rounded-lg bg-slate-100 text-slate-400 dark:bg-slate-700 dark:text-slate-500"},Bt={key:0,class:"border-t border-slate-200 p-4 text-center dark:border-slate-700"},Rt=["disabled"],Tt={key:1,class:"rounded-2xl border border-slate-200 bg-white py-16 text-center shadow-sm dark:border-slate-700 dark:bg-slate-800"},Ft=B({__name:"ProgressTracker",setup($t){const N=R(),M=V(),i=A(),x=q(),d=_(()=>N.params.scheduleId),b=T(!1),v=_(()=>i.scheduleStats?.dailyStats?i.scheduleStats.dailyStats.map(c=>c.dayLabel):[]),g=_(()=>x.getPinnedUserList(d.value));async function I(){i.scheduleStats||await i.fetchScheduleStats(d.value),await Promise.all([i.fetchUsers(d.value,{limit:50}),x.fetchPinnedUsers(d.value)])}async function D(){b.value||!i.hasMorePages||(b.value=!0,await i.fetchMoreUsers(d.value,{limit:50}),b.value=!1)}function P(c){M.push({name:"user-detail",params:{scheduleId:d.value,discordUserId:c}})}function S(c){return`https://cdn.discordapp.com/embed/avatars/${parseInt(c)%5}.png`}function C(c,e){e.stopPropagation();const s=x.isPinned(d.value,c),n=x.togglePin(d.value,c);!s&&n&&x.fetchPinnedUsers(d.value)}function p(c){return x.isPinned(d.value,c)}function f(){return x.canPin(d.value)}return $(()=>{I()}),(c,e)=>(l(),y(E,null,{default:w(()=>[t("div",X,[e[18]||(e[18]=t("div",{class:"mb-8"},[t("h1",{class:"text-2xl font-bold text-slate-800 dark:text-white"},"打卡進度追蹤"),t("p",{class:"mt-1 text-slate-500 dark:text-slate-400"},"查看所有參與者的打卡狀況")],-1)),o(i).isLoading&&!o(i).scheduleStats?(l(),a("div",G,[U(L,{size:"lg"})])):o(i).error?(l(),y(F,{key:1,message:o(i).error,onRetry:I},null,8,["message"])):o(i).scheduleStats?(l(),a(m,{key:2},[t("div",H,[t("div",J,[e[1]||(e[1]=t("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-violet-100 dark:bg-violet-900/50"},[t("i",{class:"bi bi-people-fill text-sm text-violet-600 dark:text-violet-400"})],-1)),t("span",K,[t("strong",O,r(o(i).scheduleStats.uniqueUsers),1),e[0]||(e[0]=u(" 位參與者 ",-1))])]),t("div",Q,[e[4]||(e[4]=t("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-emerald-100 dark:bg-emerald-900/50"},[t("i",{class:"bi bi-calendar-check text-sm text-emerald-600 dark:text-emerald-400"})],-1)),t("span",W,[e[2]||(e[2]=u(" 累計 ",-1)),t("strong",Y,r(o(i).scheduleStats.dailyTasks),1),e[3]||(e[3]=u(" 天 ",-1))])]),t("div",Z,[e[7]||(e[7]=t("div",{class:"flex h-8 w-8 items-center justify-center rounded-lg bg-amber-100 dark:bg-amber-900/50"},[t("i",{class:"bi bi-check2-all text-sm text-amber-600 dark:text-amber-400"})],-1)),t("span",tt,[e[5]||(e[5]=u(" 總打卡 ",-1)),t("strong",et,r(o(i).scheduleStats.totalCheckins),1),e[6]||(e[6]=u(" 次 ",-1))])])]),g.value.length>0?(l(),a("div",st,[t("div",lt,[e[8]||(e[8]=t("i",{class:"bi bi-pin-fill text-violet-500"},null,-1)),t("h2",at," 釘選用戶 ("+r(g.value.length)+"/"+r(o(x).MAX_PINNED)+") ",1)]),t("div",it,[t("div",ot,[t("table",rt,[t("thead",null,[t("tr",dt,[e[9]||(e[9]=t("th",{class:"sticky left-0 z-10 w-[200px] min-w-[200px] max-w-[200px] bg-violet-50 px-4 py-3 text-left text-sm font-semibold text-slate-700 dark:bg-violet-900/30 dark:text-slate-200"}," 參與者 ",-1)),(l(!0),a(m,null,h(v.value,s=>(l(),a("th",{key:s,class:"px-2 py-3 text-center text-xs font-medium whitespace-nowrap"},[U(o(j),{to:{name:"day-detail",params:{scheduleId:d.value,dayLabel:s}},class:"text-slate-500 transition-colors hover:text-slate-800 dark:text-slate-400 dark:hover:text-slate-200"},{default:w(()=>[u(r(s),1)]),_:2},1032,["to"])]))),128))])]),t("tbody",nt,[(l(!0),a(m,null,h(g.value,s=>(l(),a("tr",{key:s.discordUserId,class:"cursor-pointer transition-colors hover:bg-violet-50 dark:hover:bg-violet-900/20",onClick:n=>P(s.discordUserId)},[t("td",xt,[t("div",ut,[t("button",{class:"flex-shrink-0 rounded-lg p-1.5 text-violet-500 transition-colors hover:bg-violet-100 dark:hover:bg-violet-900/50",title:"取消釘選",onClick:n=>C(s.discordUserId,n)},[...e[10]||(e[10]=[t("i",{class:"bi bi-pin-fill text-sm"},null,-1)])],8,mt),t("img",{src:s.avatarUrl||S(s.discordUserId),alt:s.displayName,class:"h-8 w-8 flex-shrink-0 rounded-full object-cover ring-2 ring-violet-100 dark:ring-violet-800",loading:"lazy"},null,8,bt),t("div",vt,[t("p",ht,r(s.displayName),1),t("p",kt,r(s.totalCheckinDays)+" / "+r(v.value.length)+" 天 ",1)])])]),(l(!0),a(m,null,h(v.value,n=>(l(),a("td",{key:n,class:"px-2 py-3 text-center"},[s.checkinStatus[n]?(l(),a("span",pt,[...e[11]||(e[11]=[t("i",{class:"bi bi-check-lg text-sm"},null,-1)])])):(l(),a("span",gt,[...e[12]||(e[12]=[t("i",{class:"bi bi-dash text-sm"},null,-1)])]))]))),128))],8,ct))),128))])])])])])):k("",!0),e[17]||(e[17]=t("div",{class:"mb-3 flex items-center gap-2"},[t("i",{class:"bi bi-list-ul text-slate-500"}),t("h2",{class:"text-sm font-semibold text-slate-700 dark:text-slate-300"},"所有參與者")],-1)),t("div",ft,[t("div",_t,[t("table",yt,[t("thead",null,[t("tr",wt,[e[13]||(e[13]=t("th",{class:"sticky left-0 z-10 w-[200px] min-w-[200px] max-w-[200px] bg-slate-50 px-4 py-3 text-left text-sm font-semibold text-slate-700 dark:bg-slate-900 dark:text-slate-200"}," 參與者 ",-1)),(l(!0),a(m,null,h(v.value,s=>(l(),a("th",{key:s,class:"px-2 py-3 text-center text-xs font-medium whitespace-nowrap"},[U(o(j),{to:{name:"day-detail",params:{scheduleId:d.value,dayLabel:s}},class:"text-slate-500 transition-colors hover:text-slate-800 dark:text-slate-400 dark:hover:text-slate-200"},{default:w(()=>[u(r(s),1)]),_:2},1032,["to"])]))),128))])]),t("tbody",Ut,[(l(!0),a(m,null,h(o(i).users,s=>(l(),a("tr",{key:s.discordUserId,class:"cursor-pointer transition-colors hover:bg-slate-50 dark:hover:bg-slate-700/50",onClick:n=>P(s.discordUserId)},[t("td",Pt,[t("div",St,[t("button",{class:z(["flex-shrink-0 rounded-lg p-1.5 transition-colors",p(s.discordUserId)?"text-violet-500 hover:bg-violet-100 dark:hover:bg-violet-900/50":f()?"text-slate-400 hover:bg-slate-100 hover:text-violet-500 dark:hover:bg-slate-700":"cursor-not-allowed text-slate-300 dark:text-slate-600"]),title:p(s.discordUserId)?"取消釘選":f()?"釘選用戶":"已達釘選上限",disabled:!p(s.discordUserId)&&!f(),onClick:n=>C(s.discordUserId,n)},[t("i",{class:z(["bi text-sm",p(s.discordUserId)?"bi-pin-fill":"bi-pin"])},null,2)],10,Ct),t("img",{src:s.avatarUrl||S(s.discordUserId),alt:s.displayName,class:"h-8 w-8 flex-shrink-0 rounded-full object-cover ring-2 ring-slate-100 dark:ring-slate-700",loading:"lazy"},null,8,jt),t("div",zt,[t("p",Lt,r(s.displayName),1),t("p",Nt,r(s.totalCheckinDays)+" / "+r(v.value.length)+" 天 ",1)])])]),(l(!0),a(m,null,h(v.value,n=>(l(),a("td",{key:n,class:"px-2 py-3 text-center"},[s.checkinStatus[n]?(l(),a("span",Mt,[...e[14]||(e[14]=[t("i",{class:"bi bi-check-lg text-sm"},null,-1)])])):(l(),a("span",Dt,[...e[15]||(e[15]=[t("i",{class:"bi bi-dash text-sm"},null,-1)])]))]))),128))],8,It))),128))])])]),o(i).hasMorePages?(l(),a("div",Bt,[t("button",{class:"inline-flex items-center gap-2 rounded-xl bg-violet-600 px-5 py-2.5 text-sm font-medium text-white shadow-sm transition-all hover:bg-violet-700 disabled:opacity-50",disabled:b.value,onClick:D},[b.value?(l(),y(L,{key:0,size:"sm"})):k("",!0),u(" "+r(b.value?"載入中...":"載入更多"),1)],8,Rt)])):k("",!0)]),o(i).users.length===0?(l(),a("div",Tt,[...e[16]||(e[16]=[t("div",{class:"mb-4 flex justify-center"},[t("div",{class:"flex h-16 w-16 items-center justify-center rounded-2xl bg-slate-100 dark:bg-slate-700"},[t("i",{class:"bi bi-people text-3xl text-slate-400"})])],-1),t("p",{class:"text-slate-500 dark:text-slate-400"},"尚無參與者資料",-1)])])):k("",!0)],64)):k("",!0)])]),_:1}))}});export{Ft as default};
